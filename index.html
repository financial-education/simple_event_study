<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-11-18 Thu 14:24 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>A Simple Event Study</title>
<meta name="author" content="Matt Brigida, Ph.D." />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">A Simple Event Study</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org006be54">1. Example</a></li>
<li><a href="#org7244605">2. Overview</a></li>
<li><a href="#orgfc453d5">3. Implementation</a>
<ul>
<li><a href="#org7ec0e70">3.1. Data Preparation</a></li>
<li><a href="#org4f353c2">3.2. Regression Estimation</a>
<ul>
<li><a href="#orgea7b98e">3.2.1. XLE</a></li>
<li><a href="#orgfd3dc1b">3.2.2. XLK</a></li>
</ul>
</li>
<li><a href="#org18f7c22">3.3. Event Abnormal Returns</a>
<ul>
<li><a href="#orge290788">3.3.1. XLE</a></li>
<li><a href="#org779b684">3.3.2. XLK</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgfca8a43">4. Hypothesis Test</a>
<ul>
<li><a href="#orgf1bc774">4.1. Test Statistic</a></li>
<li><a href="#org3cae67b">4.2. Test for Significantly Different Means</a></li>
</ul>
</li>
<li><a href="#orgf18e10c">5. Counterarguments</a></li>
</ul>
</div>
</div>

<div id="outline-container-org006be54" class="outline-2">
<h2 id="org006be54"><span class="section-number-2">1.</span> Example</h2>
<div class="outline-text-2" id="text-1">
<p>
Here we are going to cover how to test for a differential effect of one event on two assets. As an example, our event will be the results of the 2020 Presidential election, and our assets will be oil (XLE) and tech (XLK) ETFs.  Our null hypothesis is:
</p>

<blockquote>
<p>
There is no difference in the reactions of XLE anf XLF to the outcome of the 2020 Presidential election.
</p>
</blockquote>

<p>
If we are able to reject the null then we have found evidence in favor of a different reaction. 
</p>
</div>
</div>

<div id="outline-container-org7244605" class="outline-2">
<h2 id="org7244605"><span class="section-number-2">2.</span> Overview</h2>
<div class="outline-text-2" id="text-2">
<p>
To calculate the effect of the event, we need to be able to calculate what each asset <i>would have done</i> if the event had not occurred.  To do this, in an event study there is an estimation period and an event period.
</p>

<p>
<b>Estimation period:</b>
</p>

<ul class="org-ul">
<li>begins when you choose and ends, say, 10 days prior to the event.</li>
<li>you estimate a market model regression (\(R_{E} = \alpha + \beta R_M + e\)) for each ETF over this period, and save the alpha and beta coefficients.  \(R_E\) is an ETF, and \(R_M\) is the return on the market.</li>
</ul>

<p>
<b>Event period:</b>
</p>

<ul class="org-ul">
<li>Calculate daily abnormal returns for each ETF.  Abnormal returns are actual returns minus expected returns.  \(R_E - \alpha - \beta R_M\) where the alpha and beta are the estimates for that particular ETF.</li>
<li>Sum the daily abnormal returns into Cumulative Abnormal Returns from 10 days before the event to 10 days after, <i>CAR(-10, 10)</i></li>
</ul>

<p>
Once you have the CARs for each ETF you can run a t-test for significantly different CARs.
</p>
</div>
</div>

<div id="outline-container-orgfc453d5" class="outline-2">
<h2 id="orgfc453d5"><span class="section-number-2">3.</span> Implementation</h2>
<div class="outline-text-2" id="text-3">
<p>
We'll implement the event study in Python, however R is probably a better choice of language given its built-in statistical capabilities.  You can also do this in Excel, though it is more tedious.
</p>

<p>
First let's load the libraries we are going to use:
</p>

<div class="org-src-container">
<pre class="src src-python">import yfinance as yf
from time import sleep
import pandas as pd
import numpy as np
import seaborn as sns
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_squared_error
</pre>
</div>
</div>

<div id="outline-container-org7ec0e70" class="outline-3">
<h3 id="org7ec0e70"><span class="section-number-3">3.1.</span> Data Preparation</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Now we can pull the data and convert it into returns:
</p>

<div class="org-src-container">
<pre class="src src-python">spy = yf.Ticker("SPY")
spy_price = spy.history(period="max")
sleep(5)
xle = yf.Ticker("XLE")
xle_price = xle.history(period="max")
sleep(5)
xlk = yf.Ticker("XLK")
xlk_price = xlk.history(period="max")
</pre>
</div>

<p>
Convert to returns:
</p>

<div class="org-src-container">
<pre class="src src-python">spy_ret = spy_price["Close"].pct_change()[1:]
xle_ret = xle_price["Close"].pct_change()[1:]
xlk_ret = xlk_price["Close"].pct_change()[1:]
all_rets = pd.concat([spy_ret, xle_ret, xlk_ret], axis=1)
all_rets.columns = ["spy", "xle", "xlk"]
</pre>
</div>

<p>
Split into estimation and event windows:
</p>

<div class="org-src-container">
<pre class="src src-python">est = all_rets.loc['2020-09-01':'2020-10-19']
event = all_rets.loc['2020-10-20':'2020-11-16']
</pre>
</div>

<p>
Let's look at the cumulative returns over the estimation and event windows.  This is not required, though it is good to take a look at your data from time to time.
</p>

<div class="org-src-container">
<pre class="src src-python">
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f353c2" class="outline-3">
<h3 id="org4f353c2"><span class="section-number-3">3.2.</span> Regression Estimation</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-orgea7b98e" class="outline-4">
<h4 id="orgea7b98e"><span class="section-number-4">3.2.1.</span> XLE</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
\[R_{XLE} = \alpha_{XLE} + \beta_{XLE} R_M + e\]
</p>

<p>
Where \(R_{XLE}\) and \(R_M\) are the returns on the <i>XLE</i> and <i>SPY</i>.  Note, \(R_M\) denotes the return on the market portfolio, and we generally use the <i>SPY</i> ETF to proxy for the market.
</p>

<div class="org-src-container">
<pre class="src src-python">xle_reg = LinearRegression().fit(est["spy"].values.reshape(-1,1), est["xle"])
xle_alpha = xle_reg.intercept_
xle_beta = xle_reg.coef_[0]
print(xle_alpha)
print(xle_beta)
xle_pred = xle_reg.predict(est["spy"].values.reshape(- 1, 1))
xle_rmse = mean_squared_error(y_true=est["xle"], y_pred=xle_pred, squared=False)
print(xle_rmse)
</pre>
</div>

<pre class="example">
-0.004507235278707284
0.773012064608419
0.017148483329475998
</pre>
</div>
</div>

<div id="outline-container-orgfd3dc1b" class="outline-4">
<h4 id="orgfd3dc1b"><span class="section-number-4">3.2.2.</span> XLK</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
\[R_{XLK} = \alpha_{XLK} + \beta_{XLK} R_M + e\]
</p>

<p>
Where \(R_{XLE}\) and \(R_M\) are the returns on the <i>XLK</i> and <i>SPY</i>.
</p>

<div class="org-src-container">
<pre class="src src-python">xlk_reg = LinearRegression().fit(est["spy"].values.reshape(-1,1), est["xlk"])
xlk_alpha = xlk_reg.intercept_
xlk_beta = xlk_reg.coef_[0]
print(xlk_alpha)
print(xlk_beta)
xlk_pred = xlk_reg.predict(est["spy"].values.reshape(- 1, 1))
xlk_rmse = mean_squared_error(y_true=est["xlk"], y_pred=xlk_pred, squared=False)
print(xlk_rmse)
</pre>
</div>

<pre class="example">
-0.0002778759141710454
1.4045777098046799
0.0065901130007539775
</pre>
</div>
</div>
</div>

<div id="outline-container-org18f7c22" class="outline-3">
<h3 id="org18f7c22"><span class="section-number-3">3.3.</span> Event Abnormal Returns</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-orge290788" class="outline-4">
<h4 id="orge290788"><span class="section-number-4">3.3.1.</span> XLE</h4>
<div class="outline-text-4" id="text-3-3-1">
<div class="org-src-container">
<pre class="src src-python">xle_ars = event["xle"] - xle_alpha - xle_beta * event["spy"]
#print(xle_ars)
xle_cars = xle_ars.cumsum()
print(xle_cars)
</pre>
</div>

<pre class="example" id="orgad34bf6">
Date
2020-10-20    0.013255
2020-10-21    0.000162
2020-10-22    0.041684
2020-10-23    0.038655
2020-10-26    0.021580
2020-10-27    0.015783
2020-10-28    0.004872
2020-10-29    0.032197
2020-10-30    0.050365
2020-11-02    0.080331
2020-11-03    0.065466
2020-11-04    0.054051
2020-11-05    0.043483
2020-11-06    0.026523
2020-11-09    0.164075
2020-11-10    0.202081
2020-11-11    0.190591
2020-11-12    0.170330
2020-11-13    0.200538
2020-11-16    0.261216
dtype: float64
</pre>
</div>
</div>


<div id="outline-container-org779b684" class="outline-4">
<h4 id="org779b684"><span class="section-number-4">3.3.2.</span> XLK</h4>
<div class="outline-text-4" id="text-3-3-2">
<div class="org-src-container">
<pre class="src src-python">xlk_ars = event["xlk"] - xlk_alpha - xlk_beta * event["spy"]
#print(xlk_ars)
xlk_cars = xlk_ars.cumsum()
print(xlk_cars)
</pre>
</div>

<pre class="example" id="org406c169">
Date
2020-10-20   -0.001900
2020-10-21   -0.000472
2020-10-22   -0.012600
2020-10-23   -0.018187
2020-10-26   -0.013652
2020-10-27   -0.003526
2020-10-28    0.002337
2020-10-29    0.005020
2020-10-30   -0.002200
2020-11-02   -0.015139
2020-11-03   -0.022025
2020-11-04   -0.014235
2020-11-05   -0.010286
2020-11-06   -0.006138
2020-11-09   -0.030748
2020-11-10   -0.047051
2020-11-11   -0.033484
2020-11-12   -0.028487
2020-11-13   -0.039168
2020-11-16   -0.046769
dtype: float64
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfca8a43" class="outline-2">
<h2 id="orgfca8a43"><span class="section-number-2">4.</span> Hypothesis Test</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgf1bc774" class="outline-3">
<h3 id="orgf1bc774"><span class="section-number-3">4.1.</span> Test Statistic</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-python">scar_xle = xle_cars.values[-1] / np.sqrt((xle_cars.shape[0] * xle_ars.values.var()))
print(scar_xle)
</pre>
</div>

<pre class="example">
1.5797900457160587
</pre>


<div class="org-src-container">
<pre class="src src-python">scar_xlk = xlk_cars.values[-1] / np.sqrt((xlk_cars.shape[0] * xlk_ars.values.var()))
print(scar_xlk)
</pre>
</div>

<pre class="example">
-1.0867631837040264
</pre>


<p>
These test statistics have a t-distribution with the length of the event window minus two degrees of freedom.  If we had a longer event window (say over 50 days) then we could use a standard normal.  We can use these to test whether a CAR is significantly different from 0.
</p>
</div>
</div>

<div id="outline-container-org3cae67b" class="outline-3">
<h3 id="org3cae67b"><span class="section-number-3">4.2.</span> Test for Significantly Different Means</h3>
<div class="outline-text-3" id="text-4-2">
<p>
\[t = \frac{CAR_{XLE} - CAR_{XLK}{\sqrt{\frac{\hat{\sigma}_{XLE}^{2} + \hat{\sigma}_{XLK}^{2}}{2}}\sqrt{\frac{2}{n}}}\]
</p>

<div class="org-src-container">
<pre class="src src-python">test_stat = (xle_cars.values[-1] - xlk_cars.values[-1]) / (np.sqrt( (xle_cars.shape[0] * xle_ars.values.var() - xlk_cars.shape[0] * xlk_ars.values.var()) / 2) * np.sqrt(2 / xle_cars.shape[0]))
print(test_stat)
</pre>
</div>

<pre class="example">
8.62731389099751
</pre>


<p>
Which is significant at the less than 1% level (see table of values from t-distribution).  So we conclude that or evidence indicates that <i>XLE</i> outperformed <i>XLK</i> around the 2020 election results.
</p>
</div>
</div>
</div>

<div id="outline-container-orgf18e10c" class="outline-2">
<h2 id="orgf18e10c"><span class="section-number-2">5.</span> Counterarguments</h2>
<div class="outline-text-2" id="text-5">
<p>
But take a look at the daily CARs, it looks like <i>XLE</i> began to outperform on 11/9 which is about 6 days after the election results were released.  So I think the event window is too long.  We should calculate <i>CAR(-5, 5)</i> and re-test for significance.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Matt Brigida, Ph.D.</p>
<p class="date">Created: 2021-11-18 Thu 14:24</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
